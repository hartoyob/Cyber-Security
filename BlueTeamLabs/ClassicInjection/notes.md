# A Classic Injection

Analyse the attached EXE sample and find answers to the following questions.<br>

Note: The EXE uses shellcode generated by the Metasploit attack framework. Make sure you analyse the sample in contained environment (we recommend a virtual machine where internet access is disabled). The sample is zipped with password “infected”. <br>

Sha256 checksum of zip – E04F383BF1F13C1E73F8A57CCD0032EF7 E8059BAE0D6EADC87A2EDC655F3A32D 

# Questions

## What is the name of the compiler used to generate the EXE?

Using **Detect-it-easy**
```bash
cmd: sudo /opt/Detect-It-Easy/docker/diec.sh analyseme.exe

filetype: PE32
arch: I386
mode: 32
endianess: LE
type: Console
  compiler: Microsoft Visual C++(-)[-]
  linker: Microsoft Linker(14.28**)[Console32,console]

```

Well, this is not the expected solution... Using **PEStudio** give us the correct answer

**Answer:** Microsoft Visual C++ 8

## This malware, when executed, sleeps for some time. What is the sleep time in minutes? 

This one is rather easy to answer, just need to load the **.exe** into IDA, check the imports and view the references to the usage of **Sleep** 
```c++
Sleep(0x2BF20u);
```
In decimal it is 180000 milliseconds which is 3 minutes

**Answer:** 3

## After the sleep time, it prompts for user password, what is the correct password?

We can see a random string there, testing it as answer it turns out to be correct

```
v3 = "btlo";
```

**Answer:** btlo

## What is the size of the shellcode?

We can see from the code generated by IDA that it copies the entire shell code from the **DATA** section into a **Buffer** with **qmemcpy** <br>

```c++
qmemcpy(&Buffer, byte_403260, 0x1D8u);
```
One small problem is that **0x1D8** (decimal 472) should indicate the number of bytes being copied but the answer is not that actually. I found it out by playing around

**Answer:** 473

## Shellcode injection involves three important windows API. What is this type of injection is called as? 

We can answer this based on some quick google search as well as the decompilation code

```c++
CreateRemoteThread(ProcessInformation.hProcess, 0, 0, (LPTHREAD_START_ROUTINE)v10, 0, 0, 0);
```

**Answer:** CreateRemoteThread

## What is the name of the victim process?

The victim process can be visualized with the code generated by IDA

```c++
CreateProcessW(
      L"C:\\Windows\\System32\\nslookup.exe",
      0,
      0,
      0,
      0,
      0x8000000u,
      0,
      0,
      &StartupInfo,
      &ProcessInformation);
```
**Answer:** nslookup.exe

## What is the file created by the sample

Using an application called Everything (which looks for file system's file modifications) and running the malware (after cloning the VM), shows the solution

**Answer:** C:\Windows\Temp\btlo.txt

## What is the message in the created file 

**Answer:** Welcome to BTLO!

## What is the program that the shellcode used to create and write this file

This was a bit trickier because i needed to use the **Event viewer** (which is horrible) but ended up finding the program that created the file 

**Answer:** powershell.exe